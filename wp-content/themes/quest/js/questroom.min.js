var qroom=qroom||{};$.cookie=function(o,e,t){if(void 0===e){var n=null;if(document.cookie&&""!=document.cookie)for(var r=document.cookie.split(";"),i=0,s=r.length;i<s;i+=1){var a=jQuery.trim(r[i]);if(a.substring(0,o.length+1)==o+"="){n=decodeURIComponent(a.substring(o.length+1));break}}return n}t=t||{},null===e&&(e="",t.expires=-1);var l,c="";t.expires&&("number"==typeof t.expires||t.expires.toUTCString)&&("number"==typeof t.expires?(l=new Date).setTime(l.getTime()+24*t.expires*60*60*1e3):l=t.expires,c="; expires="+l.toUTCString());var d=t.path?"; path="+t.path:"",m=t.domain?"; domain="+t.domain:"",p=t.secure?"; secure":"";document.cookie=[o,"=",encodeURIComponent(e),c,d,m,p].join("")};var eventer=function(o){$.extend(this,{eventPrefix:"__em_"},o)};!function(o){o.on=function(o,t){var n=this;return $(this).on(n.eventPrefix+o,function(o,e){t.call(n,{type:o.type},e)}),this},o.emit=function(o,e){return $(this).triggerHandler(this.eventPrefix+o,e),this},o.off=function(o){return $(this).off(this.eventPrefix+o),this}}(eventer.prototype),qroom.eventGlob=new eventer;var qopup=function(){};function sp(o){o.stopPropagation?o.stopPropagation():o.cancelBubble=!0}function pd(o){o.preventDefault?o.preventDefault():o.returnValue=!1}function cancelEvent(o){sp(o=(o=o||window.event||{}).originalEvent||o),pd(o)}!function(r,o){r.stack=[],$.extend(r,new eventer),r.props={width:400,showTop:!0,onlyContent:!0},r.on("close",function(o,e){0==r.stack.length?(qroom.nodes.$wrapper.removeClass("fixed"),qroom.nodes.$window.scrollTop(-document.getElementById("qroom-wrapper").style.top.replace("px","")),qroom.nodes.$wrapper.css("top",0)):r.enableFirst()}),r.on("open",function(o,e){0==e.context.index&&(qroom.nodes.$wrapper.css("top",-$(window).scrollTop()).addClass("fixed"),qroom.nodes.$window.scrollTop(0)),r.stack.length&&r.enableFirst()}),r.enableFirst=function(){var o=r.stack.length;for(var e in r.stack)r.stack[e].$box[(e==o-1?"remove":"add")+"Class"]("invisible")},r.open=function(o,e){var t=new r(e=e||{});return t.html=o,t.index=r.stack.length,r.stack.push(t),e.wr_class=e.wr_class||"",t.props=$.extend({},r.props,e),t.open(),r.emit("open",{context:t}),t},r.close=function(o){void 0===o&&(o=r.stack.length-1),r.stack[o]&&r.stack[o].close(),r.emit("close")},r.closeAll=function(){for(var o in r.stack)r.stack[o].$wrapper.remove();r.stack=[]},r.confirm=function(o,e,t,n){o="<div>"+o+'</div><div style="padding: 20px 0 0; text-align: right;"><span class="qroom-btn qopup-confirm-yes">Да</span>&nbsp;&nbsp;&nbsp;<span class="qroom-btn qopup-confirm-no">Нет</span></div>',r.open(o,{title:e,width:400,onOpen:function(){$(".qopup-confirm-yes").click(function(){t&&t(),r.close()}),$(".qopup-confirm-no").click(function(){n&&n(),r.close()})}})},r.info=function(o){o=o||{},r.open(o.msg?o.msg:"",{width:o.width||400,onClose:function(){o.onClose&&o.onClose()}})},o.open=function(){var o=this;o.render(),o.$header.html(o.props.title),o.$content.html(o.html),o.$box.css({maxWidth:o.props.width}),o.align(),o.props.onOpen&&o.props.onOpen(o)},o.align=function(){var o=this;o.$box.css({"margin-top":o.props.fixedTop?0:(o.$wrapper.height()-o.$box.height())/2}).addClass("opened")},o.close=function(){var e=this;"function"==typeof e.props.shouldClose&&!1===e.props.shouldClose()||(e.$box.css({marginTop:0}).addClass("closed"),setTimeout(function(){for(var o in e.$wrapper.remove(),r.stack.splice(e.index,1),r.stack)r.stack[o].index=o;r.emit("close"),e.props.onClose&&e.props.onClose(e)},300))},o.render=function(){var o=this;o.$wrapper=$("<div>",{id:"qopup-wrap-"+o.index,class:"qopup-wrap "+o.props.wr_class}).click(function(){qopup.close()}),o.$box=$("<div>",{class:"qopup-box"}).appendTo(o.$wrapper).click(function(o){o.stopPropagation()}),o.$header=$("<div>",{class:"qopup-header"}).appendTo(o.$box),o.$closer=$("<div>",{class:"qopup-close material-icons"}).html("close").appendTo(o.$box).click(function(){qopup.close()}),o.$content=$("<div>",{class:"qopup-content"}).appendTo(o.$box),o.$wrapper.css({"z-index":1e3+o.index}),$("#qroom-node_heap").append(o.$wrapper)}}(qopup,qopup.prototype),qroom.locks={},qroom.checkData=function(o){$(o).removeClass("fail")},qroom.submitForm=function(e,t,n){var o=(e=$(e)).closest("form");if(!o.length)return alert("Произошла ошибка, вероятней всего кнопка не в форме."),!1;var r=o[0].action,i=$("input, textarea, select",o),s=$(".form-field_errors",o),a="",l=[],c=o.hasClass("noajax");if(i.focus(function(){$(this).removeClass("_fail").parent().find(".qroom-form_field_error").slideUp()}),qroom.locks.hasOwnProperty(r)&&qroom.locks[r])return!1;if(qroom.locks[r]=!0,i.each(function(){var o=$(this),e=o.val(),t=o.data("title");if((!t||t&&!t.length)&&(t=o.attr("name")),o.hasClass("qroom-need_validate")){var n=o.data("validations");for(var r in n&&(n=n.length?n.split(","):[]),n)if(qroom.validations.hasOwnProperty(n[r])&&!qroom.validations[n[r]].func(e,o)){a+=a.length?", "+t:t,o.addClass("_fail"),l.push({input:o,validation:qroom.validations[n[r]],msg:t});break}}}),a.length)return a="Error: "+a,s.html(a),n&&n(l),qroom.locks[r]=!1;if(c)return o[0].submit(),!0;var d=o.serializeArray(),m={};for(var p in d)m[d[p].name]=d[p].value;e.addClass("_loading"),qroom.ajax.post(r,m,function(o){e.removeClass("_loading"),o.is_error?(a=o.errorMsg?o.errorMsg:"Error from server",s.html(o.errorMsg),n&&n(l)):t&&t(o),qroom.locks[r]=!1})},qroom.submitCard=function(){var o=$(".card").val();$.ajax({url:"/бонус/",data:{cardnumber:o},success:function(o){$(".result").replaceWith(o)},type:"POST"})},qroom.card=function(o){var e=$(o);e.hide(),e.next().show()},qroom.baseCallbacks={success:function(o){qopup.info({msg:o.text||"All correct",onClose:function(){}}),$(".qroom-form input[type=text]").val(""),o.invoke&&o.invoke()},error:function(o){for(var e in o)if(o[e].hasOwnProperty("input")){var t=o[e].input,n=t.data("error"),r=t.parent().find(".qroom-form_field_error");r.length&&r.text(n||o[e].msg+": "+o[e].validation.text).slideDown(100)}}},qroom.validations={not_null:{func:function(o,e){return!!o.length},text:"Empty field"},email:{func:function(o,e){return!!o.length},text:"Wrang email"},phone:{func:function(o,e){return!!o.length},text:"Wrang phone"},date:{func:function(o,e){return!!o.length},text:"Wrang date"},checked:{func:function(o,e){return!!$(e).attr("checked")},text:"Doesn't check"}},qroom.init=function(){qroom.nodes={$window:$(window),$wrapper:$("#qroom-wrapper"),$header:$(".qroom-header"),$headerNav:$(".qroom-header_nav"),$content:$(".qroom-content"),$nodeHeap:$("#qroom-node_heap"),$boxesForResize:$(".qroom-box_page")},qroom.values={},qroom.nodes.$window.scroll(qroom.actions.scroll),qroom.nodes.$window.resize(qroom.actions.resize),qroom.actions.scroll(),qroom.actions.resize(),qroom.nodes.$content.removeClass("_hidden"),qroom.timeHeaderChange=null,qroom.eventGlob.on("wheel",function(o,e){clearTimeout(qroom.timeHeaderChange)}),qroom.opinion.scroller.init(),qroom.gallery.init({selector:".qroom-childrens_7"}),$(".qroom-header_nav_item._js_show_quest").click(function(o){$(this).hasClass("_active")&&o.preventDefault()}),$(".qroom-header_nav_item._js_show_holidays").hover(function(){qroom.ttip.show({el:this,content:document.getElementById("qroom-nav_holidays_ttip_items").innerHTML,side:"bottom",fixed:!0,centered:!1,distance:0,showDistance:0,cssClass:"qroom-header_ttip_menu"}),$(this).addClass("_hovered")},function(){qroom.ttip.hide(this),$(this).removeClass("_hovered")})},qroom.actions=new function(){var o=0;this.scroll=function(){qroom.values.scrollTop=qroom.nodes.$window.scrollTop(),qroom.nodes.$header[(0<qroom.values.scrollTop?"add":"remove")+"Class"]("_black"),qroom.eventGlob.emit("wheel",{direction:qroom.values.scrollTop>o?2:1}),o=qroom.values.scrollTop},this.resize=function(){qroom.values.windowHeight=qroom.nodes.$window.outerHeight(),qroom.values.windowHeightBlock=qroom.nodes.$content.find(".qroom-page_top_box > .qroom-content_inner").outerHeight(),qroom.values.windowHeightBlock>qroom.values.windowHeight&&(qroom.values.windowHeight=qroom.values.windowHeightBlock),qroom.values.windowWidth=qroom.nodes.$window.outerWidth(),qroom.values.staticHeader=qroom.values.windowHeight<=580,qroom.nodes.$boxesForResize.each(function(){var o=$(this);o.hasClass("_height_without_header")?o.css({minHeight:qroom.values.windowHeight-qroom.nodes.$header.outerHeight()+1}):o.css({minHeight:qroom.values.windowHeight+1})})}},qroom.ajax={post:function(o,e,t){(e=e||{}).ajax=1,$.ajax({url:o,data:e,success:function(o){"function"==typeof t&&t(o)},complete:function(o){},error:function(o,e,t){},type:"POST"})}},qroom.navScroll=function(o){o.length&&(qroom.navScrollEnable=!0,$("body, html").animate({scrollTop:o.offset().top-(qroom.values.staticHeader?0:qroom.nodes.$header.outerHeight())},500),qroom.disableScroll(),setTimeout(function(){qroom.navScrollEnable=!1,qroom.enableScroll()},500))},qroom.scrollToBooking=function(){var o=$(".qroom-booking");o.length?(qroom.analytics.track("quest","header_book_button",{label:"scroll"}),qroom.navScroll(o)):(qroom.analytics.track("quest","header_book_button",{label:"home_page"}),window.location="/#booking")},qroom.disableScroll=function(){window.addEventListener&&window.addEventListener("DOMMouseScroll",qroom.preventDefault,!1),window.onwheel=qroom.preventDefault,window.onmousewheel=document.onmousewheel=qroom.preventDefault,window.ontouchmove=qroom.preventDefault,document.onkeydown=qroom.preventDefaultForScrollKeys},qroom.enableScroll=function(){window.removeEventListener&&window.removeEventListener("DOMMouseScroll",qroom.preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null},qroom.preventDefault=function(o){(o=o||window.event).preventDefault&&o.preventDefault(),o.returnValue=!1},qroom.preventDefaultForScrollKeys=function(o){if({37:1,38:1,39:1,40:1}[o.keyCode])return qroom.preventDefault(o),!1},qroom.ddn=new function(){this.toggle=function(o){$(o).toggleClass("_hover")}},qroom.quests=new function(){var d=this;d.filter=function(n){var o=$(".qroom-quests_filter_item");qroom.analytics.track("quest","filter"),o.removeClass("_active"),-1==n.type?($(".qroom-quests_filter_item._item_all").addClass("_active"),$(".qroom-quests_item").removeClass("_disabled").show("fast")):($(".qroom-quests_filter_item._item_"+n.type).addClass("_active"),$(".qroom-quests_item").each(function(){var o=$(this),e=(o.data("filter")+"").split(",");for(var t in o.addClass("_disabled"),e)e[t]==n.type&&o.removeClass("_disabled");o.hasClass("_disabled")?o.hide("fast"):o.show("fast")})),n.withScroll&&qroom.navScroll($(".qroom-quests_list"))},d.showMore=function(o,e,t){$(e).hide(),$(".button-"+t).show(),$(".qroom-booking_times_week-"+o).show(),console.log("quest.showMore - "+t)},d.bookingPopup=function(o){$("#qroom-node_heap").show(),$("#qopup-wrap-form").show();var e=$(o).attr("data-time"),t=$(o).attr("data-date"),n=$(o).attr("data-title-h1"),r=$(o).attr("data-price");$(".qroom-form #time").attr("value",e),$(".qroom-form #date").attr("value",t),$(".qroom-form #title").attr("value",n),$(".data-time").text(e),$(".data-date").text(t),$(".qroom-booking_qopup_title").text(n);$(".qroom-form #title").attr("value",n);$("#room").val(n),$(".qroom-booking_qopup_cost_holder").text(r);var i=$(o).parents(".qroom-booking_quest_title-content").find(".qroom-booking_quest_title").attr("data-title");$(".qroom-content-hom-page").parents(".customize-support").find("#room").val(i),$(".qroom-booking_qopup_title").text(i);var s=$(o).parents(".qroom-booking_quest_title-content").find(".qroom-booking_quest_title").attr("data-title");$(s)==$("Тайны да Винчи")&&console.log("55555555555"),$(s)==$("Пятый элемент")&&console.log("00000000000000");var a=$(".kvest-komnata-kontent");$(".qroom-booking_qopup_desc p.insert").html(a);var l=$(o).attr("data-id");$("#"+l)&&($(".kvest-komnata-kontent").addClass("hide"),$("#"+l).removeClass("hide")),$(".qroom-booking_terms .qroom-checkbox").each(function(){var o=$(this).find("input").val();console.log(o),"on"==o?console.log(o+" = true"):console.log(o+" = false")})},$(".qopup-close").on("click",function(){$("#qroom-node_heap").hide(),$("#qroom-wrapper").removeClass("fixed")}),d.resizeTiles=function(){var o=$(".qroom-quests_item"),e=o.length,t=0,n=qroom.values.staticHeader?0:qroom.nodes.$header.outerHeight(),r=$(".qroom-quests_filter_holder"),i=0;r.length&&(i=r.outerHeight()),1==e?(t=qroom.values.windowHeight-n,r.hide()):t=e<=3?qroom.values.windowHeight-n-i:(qroom.values.windowHeight-n-i)/2-30;var s=$(".qroom-quests_list").attr("data-height-item");s&&(t=parseInt(s)),console.log(t);for(var a=e%2,l=100/a,c=0;c<a;c++)$(o[e-1-c]).css("width",l+"%");o.css({height:Math.floor(t+11)}),e&&o.each(function(o){var e=$(this),t=e.find(".qroom-quests_item_hover_inner");e.removeClass("_mini"),e.outerHeight()<t.outerHeight()&&e.addClass("_mini")}),6<e&&r.length?(d.checkFilterPos(),qroom.eventGlob.on("wheel.filterQuest",function(o,e){d.checkFilterPos()})):qroom.eventGlob.off("wheel.filterQuest")},d.checkFilterPos=function(){var o=$(".qroom-quests_list"),e=o.offset(),t=o.outerHeight(),n=qroom.values.staticHeader?0:qroom.nodes.$header.outerHeight(),r=$(".qroom-quests_filter_holder");r.length&&r.outerHeight(),qroom.values.scrollTop+n>=e.top&&t+e.top>=qroom.values.scrollTop+qroom.values.windowHeight?r.find(".qroom-quests_filter").addClass("_fixed"):r.find(".qroom-quests_filter").removeClass("_fixed")},d.successBooking=function(o){window.location=o.message,qroom.analytics.track("quest","booking_finish")},d.errorBooking=function(o){for(var e in o)if(o[e].hasOwnProperty("input")){var t=o[e].input,n=t.data("error");t.parent().find(".qroom-form_field_error").text(n||validation.text+":"+o[e]).slideDown(100)}},d.pricesTypesPopup=function(){var o="";o+=document.getElementById("qroom-prices_popup").innerHTML,qopup.open(o,{width:600})}},qroom.location=new function(){var e=this;e.popup=function(){var o="";e.hideTtip(),o+=document.getElementById("qroom-location_popup").innerHTML,qopup.open(o,{width:800})},e.hideTtip=function(){$(".qroom-location").removeClass("_hover")},e.changeCity=function(o,e,t){if(o)return $.cookie("AutoCityId",o,{domain:t,expires:365}),console.log(window.location.hostname+" "+o),!0}},qroom.analytics=new function(){this.track=function(o,e,t){t=t||{};try{void 0===window.yaCounter?console.log("No Yandex"):window.yaCounter.reachGoal(o+"_"+e,t)}catch(o){console.log(o)}try{var n=t.label||null;ga("send","event",o,e,n),ga("b.send","event",o,e,n)}catch(o){console.log(o)}try{fbq("track",o+"_"+e)}catch(o){}}},qroom.lang=new function(){var o=this;o.get=function(o){return qroom.dictionary.hasOwnProperty(o)?qroom.dictionary[o]:""},o.hideTtip=function(){$(".qroom-lang_choice").removeClass("_hover")},o.change=function(o){console.log(o),window.location="/site/applylanguage/"+o,o.hideTtip()},o.plural=function(o,e,t,n,r,i){return i=i||!0,!o&&r?r:(i?o+" ":"")+(o%10==1&&o%100!=11?e:2<=o%10&&o%10<=4&&(o%100<10||20<=o%100)?t:n)},o.gender=function(o,e){return(o=o||["",""]).length<2?"":"m"==e?o[0]:o[1]}},qroom.opinion=new function(){this.scroller=new function(){var t=this;t.init=function(){t.$wrapper=$(".qroom-opinions_list"),t.$items=$(".qroom-opinion"),t.itemsLength=t.$items.length,t.$choicer=$(".qroom-opinions_choicer"),t.$pointerBack=$(".qroom-opinion_pointer._pointer_back"),t.$pointerForward=$(".qroom-opinion_pointer._pointer_forward"),t.curI=0,t.show(t.curI),1<t.itemsLength&&(t.$pointerBack.removeClass("_hidden"),t.$pointerForward.removeClass("_hidden"),t.renderNav()),t.$wrapper.addClass("_inited")},t.next=function(){var o=t.curI+1>t.itemsLength-1?0:t.curI+1;t.show(o)},t.prev=function(){var o=t.curI-1<0?t.itemsLength-1:t.curI-1;t.show(o)},t.show=function(o){$(t.$items[t.curI]).removeClass("_shown"),t.curI=o,$(t.$items[t.curI]).addClass("_shown"),$(".qroom-opinions_choicer_item").removeClass("_active"),$(".qroom-opinions_choicer_item._item_"+t.curI).addClass("_active")},t.renderNav=function(){for(var o="",e=0;e<t.itemsLength;e++)o+='<div class="qroom-opinions_choicer_item _item_'+e+" "+(e==t.curI?"_active":"")+'" onclick="qroom.opinion.scroller.show('+e+')"></div>';t.$choicer.html(o)}},this.popup=function(){var o="";o+=document.getElementById("qroom-opinion_popup").innerHTML,qroom.analytics.track("opinion","order_start"),qopup.open(o,{width:600})}},qroom.checkbox=function(o){var e=$(o),t=e.find("input");e.toggleClass("_checked"),t.attr("checked",e.hasClass("_checked"))},qroom.gallery=function(){},function(i,o){i.formats={img:["jpg","jpeg","png"],video:["mpg","mpeg","avi","mp4","ogv","webm"]},i.init=function(o){(new i).init(o)},i.getTypeShow=function(){},o.init=function(o){var t=this;o.selector||o.elements?(o.selector?t.$els=$(o.selector):t.$els=o.elements,t.cacheImages={},t.$els.each(function(e){$(this).click(function(o){t.open(e),cancelEvent(o)})})):console.log("selector not detected")},o.open=function(e){var t=this,o=document.getElementById("qroom-gallery_structure").innerHTML;e=e||0,t.popup=qopup.open(o,{wr_class:"qroom-gallery_popup",onOpen:function(o){t.initStructure(o.$wrapper),t.renderNav(),t.showImage(e)}}),t.opened=!0},o.initStructure=function(o){var e=this;e.$wrapper=o,e.$img=e.$wrapper.find(".qroom-gallery_img"),e.$pointerBack=e.$wrapper.find(".qroom-gallery_pointer._back"),e.$pointerForward=e.$wrapper.find(".qroom-gallery_pointer._forward"),e.$changer=e.$wrapper.find(".qroom-gallery_changer"),1<e.$els.length&&(e.$pointerBack.removeClass("_hidden"),e.$pointerForward.removeClass("_hidden"),e.$pointerBack.click(function(){e.prevImage()}),e.$pointerForward.click(function(){e.nextImage()}))},o.showImage=function(o){var n=this,r=n.$els.get(o).href;n.cutI=o,n.$changer.find(".qroom-gallery_changer_item").removeClass("_active"),n.$changer.find(".qroom-gallery_changer_item:eq("+o+")").addClass("_active"),n.$img.stop().fadeOut(100),setTimeout(function(){n.$img.html("");var o=r.split("."),e=o[o.length-1];if(-1!=_.indexOf(i.formats.video,e))n.$img.stop().show(100),n.$img[0].style.backgroundImage="none",n.$img.append('<video width="'+qroom.values.windowWidth+'" height="'+(qroom.values.windowHeight-140)+'" controls><source src="'+r+'"></video>');else if(new RegExp("youtube","gi").test(r))n.$img.stop().show(100),n.$img[0].style.backgroundImage="none",n.$img.append('<iframe width="'+qroom.values.windowWidth+'" height="'+(qroom.values.windowHeight-140)+'" src="'+r+'" frameborder="0" allowfullscreen></iframe>');else if(n.cacheImages.hasOwnProperty(r))n.$img[0].style.backgroundImage="url("+r+")",n.$img.stop().fadeIn(100);else{var t=new Image;t.onload=function(){n.cacheImages[r]=!0,n.$img[0].style.backgroundImage="url("+r+")",n.$img.fadeIn(100)},t.src=r}},100)},o.nextImage=function(){var o;o=this.cutI+1>this.$els.length-1?0:this.cutI+1,this.showImage(o)},o.prevImage=function(){var o;o=this.cutI-1<0?this.$els.length-1:this.cutI-1,this.showImage(o)},o.renderNav=function(){var t=this;t.$els.each(function(o){var e=$("<div>",{class:"qroom-gallery_changer_item _item_"+o}).appendTo(t.$changer);t.cutI==o&&e.addClass("_active"),e.click(function(){t.showImage(o)})})},o.close=function(){this.opened=!1}}(qroom.gallery,qroom.gallery.prototype),qroom.ttip=new function(){var i=this;i.collector=[],i.init=function(){$(".qroom-element_with_ttip").hover(function(){i.show({el:this})},function(){i.show(this)})},i.show=function(o){(o=o||{}).el&&(o.el.ttipTimeoutClose&&clearTimeout(o.el.ttipTimeoutClose),o.el.ttipOpened||(o.$el=$(o.el),(o=$.extend(!0,{elWidth:o.$el.outerWidth(),elHeight:o.$el.outerHeight(),elOffset:o.$el.offset(),centered:void 0===o.centered||o.centered,hoverable:void 0===o.hoverable||o.hoverable,showDistance:o.showDistance||10,distance:o.distance||10},o)).delayForClose&&(o.el.delayForClose=o.delayForClose),o.showDistance&&(o.el.showDistance=o.showDistance),void 0===(o=t(o)).content||!(o.content+"").length||(o.el.showTimeout=setTimeout(function(){e(o)},200))))},i.hide=function(o){(o=o||!1)&&(o.showTimeout&&clearTimeout(o.showTimeout),o.ttipTimeoutClose=setTimeout(function(){o.ttip&&(o.ttip.animate({left:o.parametricInfo.left,top:o.parametricInfo.top,opacity:0},100,"linear"),setTimeout(function(){o.ttip.remove(),o.ttip=!1,o.ttipOpened=!1},100))},o.delayForClose||300))},i.anyHide=function(){for(var o in i.collector)i.hide(i.collector[o])};var e=function(o){var e=a(o),t=e.$ttip,n=e.$ttipArrow;o.ttipParams={width:t.outerWidth(),height:t.outerHeight()},o.side=l(o);var r=s(o);r.arrowClass+=o.centered?" _centered":"",n.addClass(r.arrowClass),r.arrowLeft&&n.css("left",r.arrowLeft),r.arrowTop&&n.css("top",r.arrowTop),t.css({left:r.left,top:r.top,opacity:.5,position:o.fixed?"fixed":"absolute"}).animate({left:r.endLeft,top:r.endTop,opacity:1},100,"linear"),t.data("side",o.side),o.hoverable&&t.hover(function(){i.show(o)},function(){i.hide(o.el)}),o.el.parametricInfo=r,o.el.ttip=t,i.collector.push(o.el),o.el.ttipOpened=!0},s=function(o){var e,t,n,r,i;switch(o.side){case"left":r=e=o.elOffset.left-o.ttipParams.width-o.distance,e-=o.showDistance,i=t=o.centered?o.elOffset.top+(o.elHeight-o.ttipParams.height)/2:o.elOffset.top,n="_right";break;case"right":r=e=o.elOffset.left+o.elWidth+o.distance,e+=o.showDistance,i=t=o.centered?o.elOffset.top+(o.elHeight-o.ttipParams.height)/2:o.elOffset.top,n="_left";break;case"bottom":i=t=o.elOffset.top+o.elHeight+o.distance,t+=o.showDistance,r=e=o.centered?o.elOffset.left+(o.elWidth-o.ttipParams.width)/2:o.elOffset.left,n="_top";break;case"top":case"default":i=t=o.elOffset.top-o.ttipParams.height-o.distance,t-=o.showDistance,r=e=o.centered?o.elOffset.left+(o.elWidth-o.ttipParams.width)/2:o.elOffset.left,n="_bottom"}var s=$(window).scrollTop();return{left:e,top:o.fixed?t-s:t,endLeft:r,endTop:o.fixed?i-s:i,arrowClass:n}},t=function(o){return o.el.cacheContentTtip&&!o.ignoreCache?o.content=o.el.cacheContentTtip:o.content||(o.content=o.$el.data("title")),o.el.cacheContentTtip=o.content,o},a=function(o){var e=$("<div>",{class:"qroom-ttip_lib "+(o.cssClass||"")}).css({width:o.width||"auto"});return e.html(o.content),$ttipArrow=$("<div>",{class:"qroom-ttip_lib_pointer"}).appendTo(e),qroom.nodes.$nodeHeap.append(e),{$ttip:e,$ttipArrow:$ttipArrow}},l=function(o){return o.side?o.side:"top"}};